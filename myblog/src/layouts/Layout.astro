
---
interface Props {
  title: string;
}

const { title } = Astro.props;
import Analytics from '@vercel/analytics/astro';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    
    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content="Hey this is Gagan - a Computer Science undergrad building machine learning systems and building cool stuff on the web. MLE during the day and dev by the night, I ship things frequently and I build things that makes me curious. I also write tech blogs on this website" />
    <meta name="keywords" content="Machine Learning, ML Engineer, Computer Science, Web Development, Tech Blogs, zTutor, Gagan, Gagan P" />
    <meta name="author" content="Gagan P" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://gaganp.com/" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content="Gagan - a Computer Science undergrad building machine learning systems and building cool stuff on the web. MLE during the day and dev by the night, I ship things frequently and I build things that makes me curious." />
    <meta property="og:image" content="https://gaganp.com/images/bhairav1.jpg" />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://gaganp.com/" />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content="Gagan - a Computer Science undergrad building machine learning systems and building cool stuff on the web. MLE during the day and dev by the night, I ship things frequently and I build things that makes me curious." />
    <meta property="twitter:image" content="https://gaganp.com/images/bhairav1.jpg" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.cdnfonts.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/zt-formom?display=swap" rel="stylesheet">
    <meta name="generator" content={Astro.generator} />
    <meta name="color-scheme" content="light dark" />

    <!-- KaTeX for LaTeX rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    
    <!-- Prevent flash of wrong theme -->
    <script is:inline>
      const theme = (() => {
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
          return localStorage.getItem('theme');
        }
        return 'dark'; // Default to dark theme
      })();
      
      if (theme === 'light') {
        document.documentElement.classList.remove('dark');
      } else {
        document.documentElement.classList.add('dark');
      }
    </script>
  </head>
  <body class="bg-white dark:bg-black text-gray-900 dark:text-gray-100 min-h-screen flex flex-col">
    <!-- Animated background pattern -->
    <div class="fixed inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-gray-50/50 to-transparent dark:from-gray-900/50 pointer-events-none"></div>
    
    <!-- Floating particles -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
      <div class="particles-container"></div>
    </div>
    
    <!-- Header -->
    <header class="relative z-10 border-b border-gray-100 dark:border-gray-800 backdrop-blur-sm bg-white/80 dark:bg-black/80">
      <nav class="container mx-auto px-4 py-3 md:py-3 lg:max-w-4xl">
        <div class="flex justify-between items-center">
          <a href="/" class="group relative -ml-5">
            <span class="font-space text-lg md:text-xl tracking-tight relative z-10">gagan</span>
            
            <div class="absolute inset-0 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left"></div>
          </a>
          
          <div class="flex items-center space-x-3 md:space-x-6">
            <nav class="hidden md:flex space-x-6">
              <a href="/blogs" class="nav-link font-space text-sm hover:text-gray-600 dark:hover:text-gray-300 transition-colors">Blogs</a>
              <a href="/project" class="nav-link font-space text-sm hover:text-gray-600 dark:hover:text-gray-300 transition-colors">Projects</a>
              <a href="/notes" class="nav-link font-space text-sm hover:text-gray-600 dark:hover:text-gray-300 transition-colors">Notes</a>
              <a href="/#research" class="nav-link font-space text-sm hover:text-gray-600 dark:hover:text-gray-300 transition-colors">Research</a>
            </nav>
            
            <button id="theme-toggle" class="p-1.5 md:p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 relative group" style="transition: background-color 0.15s ease;">
              <div class="absolute inset-0 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full transform scale-0 group-hover:scale-100 transition-transform"></div>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 md:h-5 md:w-5 hidden dark:block relative z-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 md:h-5 md:w-5 block dark:hidden relative z-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
              </svg>
            </button>

            <button id="mobile-menu-button" class="md:hidden p-1.5 md:p-2 relative group">
              <div class="absolute inset-0 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full transform scale-0 group-hover:scale-100 transition-transform"></div>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5 md:w-6 md:h-6 relative z-10">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
          </div>
        </div>

        <!-- Mobile Navigation -->
        <div id="mobile-menu" class="hidden md:hidden mt-3 pb-1 md:pb-2">
          <div class="flex flex-col space-y-3 md:space-y-4">
            <a href="/blogs" class="nav-link font-mono text-sm hover:text-gray-600 dark:hover:text-gray-300 transition-colors">Blogs</a>
            <a href="/project" class="nav-link font-mono text-sm hover:text-gray-600 dark:hover:text-gray-300 transition-colors">Projects</a>
            <a href="/notes" class="nav-link font-mono text-sm hover:text-gray-600 dark:hover:text-gray-300 transition-colors">Notes</a>
            <a href="/#research" class="nav-link font-mono text-sm hover:text-gray-600 dark:hover:text-gray-300 transition-colors">Research</a>
          </div>
        </div>
      </nav>
    </header>

    <main class="flex-grow relative z-10">
      <slot />
    </main>

    <footer class="relative z-10 border-t border-gray-100 dark:border-gray-800 py-8 mt-20 backdrop-blur-sm bg-white/80 dark:bg-black/80">
      <div class="container mx-auto px-4">
        <div class="flex justify-between items-center">
          <div class="font-mono text-sm opacity-50">
            © {new Date().getFullYear()} gagan
          </div>
          <div class="flex space-x-6">
            <a href="https://github.com/Gagancreates" class="social-link font-mono text-sm hover:text-gray-600 dark:hover:text-gray-300 transition-colors">GitHub</a>
            <a href="" class="social-link font-mono text-sm hover:text-gray-600 dark:hover:text-gray-300 transition-colors">Twitter</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- ✅ Vercel Analytics -->
    <Analytics />

    <script>
      // Theme toggle functionality - immediate, no DOMContentLoaded wait
      const themeToggle = document.getElementById('theme-toggle');
      const htmlElement = document.documentElement;
      
      if (themeToggle) {
        themeToggle.addEventListener('click', () => {
          // Use requestAnimationFrame for smoother transition
          requestAnimationFrame(() => {
            htmlElement.classList.toggle('dark');
            const isDark = htmlElement.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
          });
        });
      }

      // Mobile menu toggle
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', () => {
          mobileMenu.classList.toggle('hidden');
        });
      }

      // Initialize KaTeX auto-render
      document.addEventListener('DOMContentLoaded', () => {
        if (typeof renderMathInElement !== 'undefined') {
          renderMathInElement(document.body, {
            delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\[', right: '\\]', display: true},
              {left: '\\(', right: '\\)', display: false}
            ],
            throwOnError: false
          });
        }

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href')?.substring(1);
            if (!targetId) return;
            
            const targetElement = document.getElementById(targetId);
            if (!targetElement) return;

            targetElement.classList.remove('scroll-highlight');
            const headerOffset = 100;
            const elementPosition = targetElement.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

            window.scrollTo({
              top: offsetPosition,
              behavior: 'smooth'
            });

            setTimeout(() => {
              targetElement.classList.add('scroll-highlight');
              setTimeout(() => {
                targetElement.classList.remove('scroll-highlight');
              }, 1000);
            }, 500);
          });
        });

        // Create floating particles
        const createParticles = () => {
          const container = document.querySelector('.particles-container');
          if (!container) return;

          const particleCount = 20;
          for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = `${Math.random() * 100}%`;
            particle.style.top = `${Math.random() * 100}%`;
            particle.style.animationDelay = `${Math.random() * 5}s`;
            container.appendChild(particle);
          }
        };

        createParticles();
      });
    </script>
  </body>
</html>

<style is:global>
  html { 
    scroll-behavior: smooth;
  }
  
  .font-mono { font-family: 'IBM Plex Mono', monospace; }
  .font-space { font-family: 'Space Grotesk', sans-serif; }
  .font-zt { 
    font-family: 'Zt Formom', sans-serif; 
  }
  
  /* Optimized transitions - only on elements that need them */
  body,
  header,
  footer,
  main {
    transition: background-color 0.2s ease, color 0.2s ease;
  }
  
  /* Theme-aware elements with optimized transitions */
  a,
  button,
  .nav-link,
  .social-link {
    transition: color 0.15s ease, opacity 0.15s ease;
  }
  
  /* Border transitions only where needed */
  header,
  footer {
    transition: background-color 0.2s ease, border-color 0.2s ease;
  }

  ::-webkit-scrollbar { width: 8px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.1); border-radius: 4px; }
  .dark ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); }

  .particle {
    position: absolute; width: 2px; height: 2px;
    background: currentColor; border-radius: 50%;
    opacity: 0.1; animation: float 15s infinite linear;
  }

  @keyframes float {
    0% { transform: translateY(0) translateX(0); opacity: 0.1; }
    50% { transform: translateY(-20px) translateX(10px); opacity: 0.2; }
    100% { transform: translateY(0) translateX(0); opacity: 0.1; }
  }

  .nav-link { position: relative; padding: 0.25rem 0; cursor: pointer; }
  .nav-link::after {
    content: ''; position: absolute; bottom: 0; left: 0;
    width: 100%; height: 1px; background: currentColor;
    transform: scaleX(0); transform-origin: right;
    transition: transform 0.3s ease;
  }
  .nav-link:hover::after { transform: scaleX(1); transform-origin: left; }

  .social-link { position: relative; padding: 0.25rem 0; }
  .social-link::before {
    content: ''; position: absolute; bottom: 0; left: 0;
    width: 100%; height: 1px; background: currentColor;
    transform: scaleX(0); transform-origin: right;
    transition: transform 0.3s ease;
  }
  .social-link:hover::before { transform: scaleX(1); transform-origin: left; }

  .scroll-highlight { animation: highlightSection 1s ease-out; }
  @keyframes highlightSection {
    0% { transform: translateY(20px); opacity: 0.5; }
    100% { transform: translateY(0); opacity: 1; }
  }

  /* KaTeX styling */
  .katex { font-size: 1.1em; }
  .katex-display { overflow-x: auto; overflow-y: hidden; }
</style>
